@using Microsoft.AspNetCore.Identity;
@using ShiftType.DbModels;
@inject UserManager<User> UserManager
@{
    var user = await UserManager.GetUserAsync(User);

}
<style>
    :root {
        --bg-color: #1e1e1e;
        --main-color: #007acc;
        --caret-color: #569cd6;
        --sub-color: #4d4d4d;
        --sub-alt-color: #191919;
        --text-color: #d4d4d4;
        --error-color: #f44747;
        --error-extra-color: #f44747;
        --colorful-error-color: #f44747;
        --colorful-error-extra-color: #f44747;
    }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://localhost:7228/img/99bdd2d4-4435-4ba0-bdda-3c37e1852c55.png" rel="icon">
<title>@ViewData["Title"]</title>
<link rel="stylesheet" href="/css/site.css">
@RenderSection("styles", required: false)

<div id="app" class="">
    <div></div>
    <div id="contentWrapper" class="" style="opacity: 1; padding-top: 32px;">
        <header class="">
            <a id="logo" href="/" router-link="">
                <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                         style="isolation:isolate" viewBox="-680 -1030 300 180">
                        <g>
                            <path d="M -430 -910 L -430 -910 C -424.481 -910 -420 -905.519 -420 -900 L -420 -900 C -420 -894.481 -424.481 -890 -430 -890 L -430 -890 C -435.519 -890 -440 -894.481 -440 -900 L -440 -900 C -440 -905.519 -435.519 -910 -430 -910 Z">
                            </path>
                            <path d=" M -570 -910 L -510 -910 C -504.481 -910 -500 -905.519 -500 -900 L -500 -900 C -500 -894.481 -504.481 -890 -510 -890 L -570 -890 C -575.519 -890 -580 -894.481 -580 -900 L -580 -900 C -580 -905.519 -575.519 -910 -570 -910 Z ">
                            </path>
                            <path d="M -590 -970 L -590 -970 C -584.481 -970 -580 -965.519 -580 -960 L -580 -940 C -580 -934.481 -584.481 -930 -590 -930 L -590 -930 C -595.519 -930 -600 -934.481 -600 -940 L -600 -960 C -600 -965.519 -595.519 -970 -590 -970 Z">
                            </path>
                            <path d=" M -639.991 -960.515 C -639.72 -976.836 -626.385 -990 -610 -990 L -610 -990 C -602.32 -990 -595.31 -987.108 -590 -982.355 C -584.69 -987.108 -577.68 -990 -570 -990 L -570 -990 C -553.615 -990 -540.28 -976.836 -540.009 -960.515 C -540.001 -960.345 -540 -960.172 -540 -960 L -540 -960 L -540 -940 C -540 -934.481 -544.481 -930 -550 -930 L -550 -930 C -555.519 -930 -560 -934.481 -560 -940 L -560 -960 L -560 -960 C -560 -965.519 -564.481 -970 -570 -970 C -575.519 -970 -580 -965.519 -580 -960 L -580 -960 L -580 -960 L -580 -940 C -580 -934.481 -584.481 -930 -590 -930 L -590 -930 C -595.519 -930 -600 -934.481 -600 -940 L -600 -960 L -600 -960 L -600 -960 L -600 -960 L -600 -960 L -600 -960 L -600 -960 L -600 -960 C -600 -965.519 -604.481 -970 -610 -970 C -615.519 -970 -620 -965.519 -620 -960 L -620 -960 L -620 -940 C -620 -934.481 -624.481 -930 -630 -930 L -630 -930 C -635.519 -930 -640 -934.481 -640 -940 L -640 -960 L -640 -960 C -640 -960.172 -639.996 -960.344 -639.991 -960.515 Z ">
                            </path>
                            <path d=" M -460 -930 L -460 -900 C -460 -894.481 -464.481 -890 -470 -890 L -470 -890 C -475.519 -890 -480 -894.481 -480 -900 L -480 -930 L -508.82 -930 C -514.99 -930 -520 -934.481 -520 -940 L -520 -940 C -520 -945.519 -514.99 -950 -508.82 -950 L -431.18 -950 C -425.01 -950 -420 -945.519 -420 -940 L -420 -940 C -420 -934.481 -425.01 -930 -431.18 -930 L -460 -930 Z ">
                            </path>
                            <path d="M -470 -990 L -430 -990 C -424.481 -990 -420 -985.519 -420 -980 L -420 -980 C -420 -974.481 -424.481 -970 -430 -970 L -470 -970 C -475.519 -970 -480 -974.481 -480 -980 L -480 -980 C -480 -985.519 -475.519 -990 -470 -990 Z">
                            </path>
                            <path d=" M -630 -910 L -610 -910 C -604.481 -910 -600 -905.519 -600 -900 L -600 -900 C -600 -894.481 -604.481 -890 -610 -890 L -630 -890 C -635.519 -890 -640 -894.481 -640 -900 L -640 -900 C -640 -905.519 -635.519 -910 -630 -910 Z ">
                            </path>
                            <path d=" M -515 -990 L -510 -990 C -504.481 -990 -500 -985.519 -500 -980 L -500 -980 C -500 -974.481 -504.481 -970 -510 -970 L -515 -970 C -520.519 -970 -525 -974.481 -525 -980 L -525 -980 C -525 -985.519 -520.519 -990 -515 -990 Z ">
                            </path>
                            <path d=" M -660 -910 L -680 -910 L -680 -980 C -680 -1007.596 -657.596 -1030 -630 -1030 L -430 -1030 C -402.404 -1030 -380 -1007.596 -380 -980 L -380 -900 C -380 -872.404 -402.404 -850 -430 -850 L -630 -850 C -657.596 -850 -680 -872.404 -680 -900 L -680 -920 L -660 -920 L -660 -900 C -660 -883.443 -646.557 -870 -630 -870 L -430 -870 C -413.443 -870 -400 -883.443 -400 -900 L -400 -980 C -400 -996.557 -413.443 -1010 -430 -1010 L -630 -1010 C -646.557 -1010 -660 -996.557 -660 -980 L -660 -910 Z ">
                            </path>
                        </g>
                    </svg>
                </div>
                <h1 class="text">
                    shifttype
                </h1>
            </a>
            <nav>
                <a id="startTestButton" class="textButton view-start" href="/" onclick="this.blur()" router-link=""
                   title="start test">
                    <div class="icon"><i class="fas fa-fw fa-keyboard"></i></div>
                </a><button class="textButton leaderboards view-leaderboards" onclick="this.blur()" title="leaderboard">
                    <div class="icon" id="leaderboardswitch"><i class="fas fa-fw fa-crown"></i></div>
                </button> <a class="textButton view-about" href="/about" onclick="this.blur()" router-link=""
                             title="about">
                    <div class="icon"><i class="fas fa-fw fa-info"></i></div>
                </a><a class="textButton view-settings" href="/settings" onclick="this.blur()" router-link=""
                       title="settings">
                    <div class="icon"><i class="fas fa-fw fa-cog"></i></div>
                </a>
                <div></div>
                @if (User.Identity.IsAuthenticated && user != null)
                {

                    <a class="textButton account view-account" href="/account/account" onclick="this.blur()"
                       router-link="" style="opacity: 1; pointer-events: auto;">
                        <div class="loading hidden" style="opacity: 0;">
                            <i class="fas fa-fw fa-spin fa-circle-notch"></i>
                        </div>
                        <div class="avatar"></div>

                        <div class="user" style="opacity: 1;"><i class="fas fa-fw fa-user"></i></div>
                        <div class="text">@user.VisibleName</div>
                        <div class="levelAndBar">
                            <div class="level">@user.Level</div>
                        </div>
                    </a>
                    <button class="text signInOut" onclick="logout()">
                        <div class="icon"><i class="fas fa-fw fa-sign-out-alt"></i></div>
                    </button>
                }
                else
                {
                    <button class="text signInOut" onclick="gotoLogin()">
                        <div class="icon"><i class="far fa-fw fa-user"></i><span style="margin-left:7px">login</span></div>
                    </button>
                }
            </nav>
            @RenderSection("header",required:false)

        </header>

        <div>
            @RenderBody()
        </div>
        <footer class="">
            <div id="commandLineMobileButton"><i class="fas fa-terminal"></i></div>
            <div class="keyTips">
                <key>esc</key> - restart test<br>
            </div>
            <div class="leftright">
                <div class="left">
                    <button class="textButton" id="contactPopupButton">
                        <i class="fas fa-fw fa-envelope"></i>
                        <div class="text">Contact</div>
                    </button> <button id="supportMeButton" class="textButton">
                        <i class="fas fa-fw fa-donate"></i>
                        <div class="text">Support</div>
                    </button> <a href="https://github.com/monkeytypegame/monkeytype" class="textButton" target="_blank"
                                 rel="noreferrer noopener">
                        <i class="fas fa-fw fa-code"></i>
                        <div class="text">GitHub</div>
                    </a><a href="https://www.discord.gg/monkeytype" class="textButton" target="_blank"
                           rel="noreferrer noopener">
                        <i class="fab fa-fw fa-discord"></i>
                        <div class="text">Discord</div>
                    </a><a href="https://twitter.com/monkeytypegame" class="textButton" target="_blank"
                           rel="noreferrer noopener">
                        <i class="fab fa-fw fa-twitter"></i>
                        <div class="text">Twitter</div>
                    </a><a href="/./terms-of-service.html" class="textButton" target="_blank">
                        <i class="fas fa-fw fa-file-contract"></i>
                        <div class="text">Terms</div>
                    </a><a href="/./security-policy.html" class="textButton" target="_blank">
                        <i class="fas fa-fw fa-shield-alt"></i>
                        <div class="text">Security</div>
                    </a><a href="/./privacy-policy.html" class="textButton" target="_blank">
                        <i class="fas fa-fw fa-lock"></i>
                        <div class="text">Privacy</div> 
                    </a>
                </div>
            </div>
            @RenderSection("footer",required:false)
        </footer>
    </div>
    <div></div>
</div>
<div id="popups">
    <div id="leaderboardsWrapper" class="popupWrapper" style="opacity: 1; display:none;"
         data-select2-id="select2-data-leaderboardsWrapper">
        <div id="leaderboards" data-select2-id="select2-data-leaderboards">
            <div class="leaderboardsTop" data-select2-id="select2-data-12-vz3c">
                <div class="mainTitle">All-Time English Leaderboards</div>
                <div class="textButton showYesterdayButton hidden">
                    <i class="fas fa-calendar-day"></i>
                    <div class="text">Show yesterday</div>
                </div>
            </div>
            <div class="tables">
                <div class="titleAndTable" id="leaderboardContainer15s">
                </div>
                <div class="titleAndTable" id="leaderboardContainer60s">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js" integrity="sha512-FJ2OYvUIXUqCcPf1stu+oTBlhn54W0UisZB/TNrZaVMHHhYvLBV9jMbvJYtvDe5x/WVaoXZ6KB+Uqe5hT2vlyA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    console.log(`@User.Identity.IsAuthenticated`);
    function gotoLogin() {
        window.location.href = "/Auth/Login";
    }
    function gotoRegister() {
        window.location.href = "/Auth/Register";
    }
    function logout() {
        fetch('/Auth/Logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/Auth/Login';
                } else {

                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    var leaderboardWrapper = document.getElementById('leaderboardsWrapper');
    leaderboardWrapper.addEventListener('click', function (event) {
        if (event.target === leaderboardWrapper) {
            leaderboardWrapper.style.display = 'none';
            }
        });

    $(document).ready(function () {
        function loadPartialView(containerId, seconds) {
            $.ajax({
                url: '@Url.Action("RenderLeaderboard", "Type")',
                type: 'GET',
                data: { seconds: seconds },
                success: function (result) {
                    $("#" + containerId).html(result);
                },
                error: function () {
                    $("#" + containerId).html("Error occurred while loading the partial view.");
                }
            });
        }
        if(`@User.Identity.IsAuthenticated` == "True"){
        loadPartialView("leaderboardContainer15s", 15);
        loadPartialView("leaderboardContainer60s", 60);
        }
    });
    document.getElementById("leaderboardswitch").addEventListener("click",function(){
        leaderboardWrapper.style.display = 'flex';
    });
    document.addEventListener("keydown",function()
    {
        if(event.key=="Escape" && document.getElementById('leaderboardsWrapper').style.display == "flex" )
        {
            leaderboardWrapper.style.display = 'none';
        }
    });
</script>
@RenderSection("scripts",required:false);